# ARCH LINUX T2 ( xanmod / systemd-boot )

# підготовка
скачати ios - github.com/t2linux/archiso-t2/releases
запис на флешку - etcher.balena.io
вставити флешку
включити пк і зажати optin
вибрати Arch Linux install medium
enter

# підключення до інтернету по wifi
iwctl # вхід в програму для wifi
 station wlan0 get-networks # сканування доступних wifi
 station wlan0 connect 'name_wifi' # підключиння до wifi
 exit # вихід з програми
ping google.com # перевірка інтернету
controc + c # зупинняє перевірку

# налаштування часу
timedatectl set-ntp true # підключення до сервера з даними про час
timedatectl set-timezone Europe/Stockholm # налаштування часової зони
timedatectl status # перевірка

# розбиття диску
fdisk -l # перегляд дисків
fdisk nameofdisk # вхід в редагування диску
d
 1 # потрібно видалити всі розділи по черзі (повторити поки все не видалю)
g # налаштування сестеме диску
n
 enter
  enter
   +512M
    y # виділиння розділу для efi (запуск пк) (512M)
n
 enter
  enter
   enter
    y # виділиння розділу для root (сестема) (23G < nG)
t
 1
  1 # зміна типу розділу для efi
w # зберегти зміни і вийти

# форматування диску
fdisk -l # перегляд дисків
mkfs.fat -F32 /dev/efi_partition # формотування розділу для efi
mkfs.ext4 /dev/root_partition # формотування розділу для root

# монтування диску
mount /dev/root_partition /mnt # монтування розділу root в папку /mnt
mount --mkdir /dev/efi_partition /mnt/boot # монтування розділу efi в папку /mnt/boot

# встановлення системи
pacstrap /mnt base linux-xanmod-t2 linux-firmware apple-bcm-firmware
 # base - для запуску arch
 # linux-xanmod-t2 - для роботи системи з чипом t2
 # linux-firmware - для роботи апаратних компонентів (клавіатура, трекпад...)
 # apple-bcm-firmware - для роботи Wi-Fi та Bluetooth на чипі t2

# налаштування системи
genfstab -U /mnt >> /mnt/etc/fstab # генеруйте файл fstab 
arch-chroot /mnt # перехід до коренової папки в новій сестемі

ln -sf /usr/share/zoneinfo/Europe/Stockholm /etc/localtime # встановлення часової зони
hwclock --systohc # синхронізація часу

pacman -S vim iwd dhcpcd sudo # встановлення базових інструментів
 # vim - для редагування файлів
 # iwd, dhcpcd - для роботи інтернету
 # sudo - для того щоб користувач міг виконувати команди від root прав

# vim - інструкція
 # i - писати
 # control + c - вийти з режиму писання
 # shift + : - консоль 
  # wq + return - вийти і зберегти файл

vim /etc/locale.gen {
en_US.UTF-8 UTF-8
uk_UA.UTF-8 UTF-8 
} # розкоментувати для налаштування розкладки
locale-gen # генерування налаштування розкладки
echo "LANG=en_US.UTF-8" > /etc/locale.conf # запис мови в locale.conf

echo "hostname" > /etc/hostname # hostname = придумати імʼя пк # крім шляху # написати імя хоста (компютера)
vim /etc/hosts {
127.0.0.1    localhost
::1          localhost
127.0.1.1    hostname.localdomain    hostname 
} # налаштування мережі

vim /etc/mkinitcpio.conf { MODULES(apple-bce) } # запис модуля для роботи з t2
mkinitcpio -P # перезапис образу initramfs з налаштуванням модуля

# налаштування користувачів root і user
passwd
 password
  password # встановлення паролю для root
useradd -m -G wheel user_name # створиння користувача
passwd user_name
 password
  password # пароль для користувача
EDITOR=vim # налаштування класичного редактору
visudo { %wheel ALL=(ALL:ALL) NOPASSWD: ALL } # розкоментувати щоб користувач міг викликати команду sudo

# встановлення загрузчика systemd-boot (програма яка запускає пк)
bootctl --path=/boot install # встановлення загрузчика
vim /boot/loader/loader.conf {
default arch.conf 
} # писати в першому рядку # налаштуваня типової сестеми
blkid (/dev/root_partition) # перегляд UUID root розділу
vim /boot/loader/entries/arch.conf {
title Arch Linux
linux /vmlinuz-linux-xanmod-t2 # переглянути в папці /boot/
initrd /initramfs-linux-xanmod-t2.img # переглянути в папці /boot/
options root=UUID=root_partition_UUID rw intel_iommu=on iommu=pt pcie_ports=compat 
                                         # додаткові налаштування для роботи звуку з чіпом t2 
} # налаштування для загрузчика

# вихід
exit
виключити пк
вийняти флешку

# джерела:
## офіційна інструкція по встановленні Arch - wiki.archlinux.org/title/Installation_guide
### інструкції для macbook - wiki.archlinux.org/title/Laptop/Apple
#### інструкція для macbook pro 2019 на intel/t2 - wiki.t2linux.org/distributions/arch/installation/

включити пк
enter
 user
  password

# wifi / wiki.archlinux.org/title/Network_configuration / налаштування інтернету
sudo systemctl enable --now dhcpcd
sudo systemctl enable --now iwd
iwctl
 device list # wlan0
 station wlan0 get-networks
 station wlan0 connect 'wifi'
 exit
ping google.com
controc + c

# pacman / софт для кирування софтом
sudo vim /etc/pacman.conf {
[multilib]
Include = /etc/pacman.d/mirrorlist 

[arch-mact2]
Server = https://mirror.funami.tech/arch-mact2/os/x86_64
SigLevel = Never 
} # налаштування серверів оновлення
sudo pacman -Syyu # оновлення налаштуваннь і пакетів

# x / wiki.archlinux.org/title/xorg / графіка
sudo pacman -S xorg-server xorg-xinit xorg-xsetroot xorg-xrandr libxft xorgproto libx11 libxinerama # встановлення пакетів для роботи x
 # xorg-server - сервер x
 # xorg-xrdb - база даних для сервера x
 # xorg-xinit - для запуску x
 # xorg-xrandr - для розширення екрану
 # libxft, xorgproto, libx11, libxinerama - хз без цього не працює
# чп
виключити пк
 включити пк
  enter
   user
    password
sudo pacman -S xorg-server xorg-xinit xorg-xsetroot xorg-xrandr libxft xorgproto libx11 libxinerama
 sudo rm /var/lib/pacman/db.lck
  sudo pacman -S xorg-server xorg-xinit xorg-xsetroot xorg-xrandr libxft xorgproto libx11 libxinerama
vim .xinitrc { 
exec dwm 
} # запуск віконого менеджера

# встановлення інструментів для налаштування програм / потім можна все видалити
sudo pacman -S base-devel git wget
 # base-devel - інструменти для збирання програм
 # git - для клонування програм
 # wget - викачує файли з посилань

# font / wiki.archlinux.org/title/Fonts | github.com/IdreesInc/Monocraft / шрифт
sudo wget --directory-prefix=/usr/share/fonts/ https://github.com/IdreesInc/Monocraft/releases/download/v3.0/Monocraft.ttf

# dwm / dwm.suckless.org / віконий менеджер
git clone https://git.suckless.org/dwm # клонування коду програми
cd dwm
cp config.def.h config.h
vim config.h # шрифти замінити на monocraft
sudo make clean install # зібрати програму
cd ..

# st / st.suckless.org / термінал
git clone https://git.suckless.org/st # клонування коду програми
cd st
sudo make clean install
cd ..

# qutebrowser / github.com/qutebrowser/qutebrowser / браузер
sudo pacman -S qutebrowser # скачати браузер
# чп
виключити пк
 включити пк
  enter
   user
    password
sudo pacman -S qutebrowser

startx
 shift + option + q # закрити
 shift + option + return # термінал
